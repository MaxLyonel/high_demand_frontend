<nz-card nzTitle="CONFIGURACIÓN DE FECHAS OPERATIVAS" [nzBordered]="true" class="config-card">

  <form nz-form [formGroup]="configForm" (ngSubmit)="submitForm()" nzLayout="vertical">
    <!-- Fases en disposición horizontal -->
    <div class="phases-horizontal">
      <div
        *ngFor="let phase of phases"
        class="phase-card"
        [class.phase-special]="phase.id === 'lottery'">

        <div class="phase-header">
          <div class="phase-icon" [style.background]="getPhaseColor(phase.color)">
            <i nz-icon [nzType]="phase.icon"></i>
          </div>
          <div class="phase-info">
            <h4 class="phase-title">{{ phase.title }}</h4>
            <p class="phase-description">{{ phase.description }}</p>
            <nz-tag [nzColor]="getStatusColor(phase.status || 'default')">
              {{ getStatusText(phase.status || 'default') }}
            </nz-tag>
          </div>
        </div>

        <div class="phase-dates">
          <!-- Para fases normales (con rango de fechas) -->
          <div *ngIf="phase.id !== 'lottery'" class="date-range-section">
            <nz-form-item>
              <nz-form-label>Rango de Fechas</nz-form-label>
              <nz-form-control>
                <nz-range-picker
                  [nzShowTime]="true"
                  [nzFormat]="'dd/MM/yyyy HH:mm'"
                  [nzDisabledDate]="getDisabledDateForPhase(phase.id)"
                  [(ngModel)]="selectedDateRanges[phase.id]"
                  (ngModelChange)="onDateRangeChange($event, phase)"
                  [ngModelOptions]="{standalone: true}"
                  (nzOnOk)="onAcceptDateRange($event, phase)"
                  style="width: 100%">
                </nz-range-picker>
              </nz-form-control>
            </nz-form-item>

            <div class="date-display" *ngIf="getPhaseDateRange(phase).length === 2">
              <div class="date-item">
                <i nz-icon nzType="calendar" nzTheme="outline"></i>
                <span>Inicio: {{ formatDate(getPhaseDateRange(phase)[0]) }}</span>
              </div>
              <div class="date-item">
                <i nz-icon nzType="calendar" nzTheme="outline"></i>
                <span>Fin: {{ formatDate(getPhaseDateRange(phase)[1]) }}</span>
              </div>
            </div>
          </div>

          <!-- Para el sorteo (fecha única) -->
          <div *ngIf="phase.id === 'lottery'" class="single-date-section">
            <nz-form-item>
              <nz-form-label>Fecha y Hora del Sorteo</nz-form-label>
              <nz-form-control>
                <nz-range-picker
                  [nzShowTime]="true"
                  nzFormat="dd/MM/yyyy HH:mm"
                  [(ngModel)]="selectedLotteryDate[phase.id]"
                  [nzDisabledDate]="getDisabledDateForPhase(phase.id)"
                  (ngModelChange)="onLotteryDateChange($event, phase)"
                  [ngModelOptions]="{standalone: true}"
                  (nzOnOk)="onAcceptDateRange($event, phase)"
                  style="width: 100%">
                </nz-range-picker>
              </nz-form-control>
            </nz-form-item>
            <div class="date-display" *ngIf="getPhaseDateRange(phase).length === 2">
              <div class="date-item">
                <i nz-icon nzType="gift" nzTheme="outline"></i>
                <span>Inicio: {{ formatDate(getPhaseDateRange(phase)[0]) }}</span>
              </div>
              <div class="date-item">
                <i nz-icon nzType="calendar" nzTheme="outline"></i>
                <span>Fin: {{ formatDate(getPhaseDateRange(phase)[1]) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Acciones del formulario -->
    <div class="form-actions">
      <button
        nz-button
        nzType="primary"
        [nzLoading]="isLoading"
        [disabled]="!configForm.valid || !canManageConfig"
        type="submit">
        Guardar Configuración
      </button>
      <!-- <button
        nz-button
        nzType="default"
        class="ml-2"
        (click)="resetForm()"
        [disabled]="!canManageConfig"
        type="button">
        Restablecer
      </button> -->
    </div>
  </form>
</nz-card>

<!-- Modal de confirmación -->
<nz-modal
  [(nzVisible)]="isVisibleModal"
  nzTitle="Confirmación"
  (nzOnCancel)="handleCancel()"
  (nzOnOk)="handleOk()"
>
  <ng-container *nzModalContent>
    <p>¿Está seguro que desea guardar esta configuración de fechas?</p>
    <nz-alert nzType="warning" nzMessage="Esta acción afectará el flujo del operativo" class="mt-2"></nz-alert>
  </ng-container>
</nz-modal>