<!-- follow.component.html -->
<div class="tracking-container">
  <div class="tracking-content">
    <h1 class="tracking-title">SEGUIMIENTO DE PREINSCRIPCIONES</h1>

    <nz-card class="search-section">
      <div class="search-header">BUSCAR PREINSCRIPCIÓN</div>
      <div nz-row nzGutter="16">
        <div nz-col nzSpan="18">
          <input
            nz-input
            [(ngModel)]="searchTerm"
            placeholder="Ingrese la cédula de identidad del postulante"
            (keyup.enter)="searchApplication()"
            class="search-input" />
        </div>
        <div nz-col nzSpan="6">
          <button
            nz-button
            nzType="primary"
            (click)="searchApplication()"
            [nzLoading]="isLoading"
            style="width: 100%">
            Buscar
          </button>
        </div>
      </div>
    </nz-card>

    <!-- @if(!isLoading && searchResults.length === 0 && searchTerm) {
      <div class="no-results">
        <nz-alert
          nzType="info"
          nzMessage="No se encontraron resultados para su búsqueda."
          nzDescription="Verifique el carnet ingresado e intente nuevamente.">
        </nz-alert>
      </div>
    } -->

    @if(searchResults.length > 0) {
      <div class="results-table-container">
        <div class="applicant-header">
          <div class="applicant-name">{{ searchResults[0].applicantName }}</div>
          <div class="applicant-info">C.I. {{ searchResults[0].identityCard }} | {{ searchResults.length }} preinscripción(es) encontrada(s)</div>
        </div>

        <div class="table-wrapper">
          <table class="preinscription-table">
            <thead>
              <tr>
                <th>CÓDIGO</th>
                <th>FECHA DE INSCRIPCIÓN</th>
                <th>UNIDAD EDUCATIVA</th>
                <th>NIVEL EDUCATIVO</th>
                <th>CURSO</th>
                <th>JUSTIFICATIVO</th>
                <th>ESTADO</th>
                <th>ACCIONES</th>
              </tr>
            </thead>
            <tbody>
              @for (preinscripcion of searchResults; track preinscripcion.id) {
                <tr>
                  <td>{{ preinscripcion.applicationCode }}</td>
                  <td>{{ preinscripcion.applicationDate }}</td>
                  <td>{{ preinscripcion.institutionName }}</td>
                  <td>{{ preinscripcion.educationalLevel }}</td>
                  <td>{{ preinscripcion.course }}</td>
                  <td>{{ preinscripcion.justification }}</td>
                  <td>
                    <span class="status-badge" [ngClass]="'status-' + preinscripcion.status">
                      {{ preinscripcion.status }}
                    </span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <!-- <button
                        class="btn btn-details"                         (click)="viewDetails(preinscripcion)">
                        <i nz-icon nzType="eye"></i> Ver Detalle
                      </button> -->
                      <button
                        nz-button
                        class="btn btn-pdf"
                        (click)="downloadCertificate(preinscripcion)"
                        [nzLoading]="isDownloading[preinscripcion.id]"
                      >
                        <i nz-icon nzType="download"></i>
                        {{ isDownloading[preinscripcion.id] ? 'Descargando...' : 'PDF' }}
                      </button>
                        <!-- [disabled]="preinscripcion.status !== 'ACEPTADO'" -->
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }
  </div>
</div>